---
import Base from '../layouts/Base.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('blog', ({ data }) => !data.draft);
const sortedPosts = posts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<Base title="Mike Vincent">
  <div class="section-content">
    <div class="row">
      <div class="column large-centered large-10 small-12">
        <div class="posts-grid">
          {sortedPosts.map(post => {
            const dateStr = post.data.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            const isoDate = post.data.date.toISOString().split('T')[0];
            return (
              <div class="post-card">
                <div class="post-header">
                  <img src="/assets/images/headshot.jpg" alt="Mike Vincent" class="post-avatar" />
                  <div class="post-header-text">
                    <div class="title-row">
                      <h2><a href={`/blog/${post.id}/`}>{post.data.title}</a></h2>
                      <button class="post-menu" aria-label="More options">&#8942;</button>
                    </div>
                    <p class="subtitle">{post.data.subtitle}</p>
                  </div>
                </div>
                {post.data.image && <img src={post.data.image} alt="" class="post-image" />}
                <div class="body">
                  <p><time class="dateline" datetime={isoDate}>{dateStr}</time> â€” {post.body?.slice(0, 150)}...</p>
                </div>
              </div>
            );
          })}
        </div>
      </div>
    </div>
  </div>
</Base>
