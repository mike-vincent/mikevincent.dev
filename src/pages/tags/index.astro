---
import Base from '../../layouts/Base.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('blog', ({ data }) => !data.draft);

// Build tag map
const tagMap = new Map<string, typeof posts>();
posts.forEach(post => {
  post.data.tags.forEach(tag => {
    if (!tagMap.has(tag)) tagMap.set(tag, []);
    tagMap.get(tag)!.push(post);
  });
});

// Sort tags alphabetically
const sortedTags = [...tagMap.entries()].sort((a, b) => a[0].localeCompare(b[0]));
---

<Base title="Tags - Mike Vincent">
  <div class="section-content">
    <div class="row">
      <div class="column large-centered large-10 small-12">
        <div class="tags-content">
          <h1>Tags</h1>

          {sortedTags.map(([tag, tagPosts]) => {
            const sorted = tagPosts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
            return (
              <div class="tag-section" id={tag}>
                <h2>{tag}</h2>
                <ul class="tag-posts">
                  {sorted.map(post => {
                    const dateStr = post.data.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                    return (
                      <li>
                        <a href={`/blog/${post.id}/`}>{post.data.title}</a>
                        <span class="post-date">{dateStr}</span>
                      </li>
                    );
                  })}
                </ul>
              </div>
            );
          })}
        </div>
      </div>
    </div>
  </div>
</Base>

<style>
  h1 {
    font-size: 32px;
    font-weight: 700;
    margin: 0 0 32px;
  }
</style>
