---
import { ViewTransitions } from 'astro:transitions';

interface Props {
  title: string;
  description?: string;
  image?: string;
}

const { title, description = "Mike Vincent - Software Engineer", image } = Astro.props;
const pathname = Astro.url.pathname;
const knownPages = ['/', '/about', '/about/', '/resume', '/resume/', '/tags', '/tags/'];
const isPost = !knownPages.includes(pathname) && pathname !== '/';
const isHome = pathname === '/';
const isBio = pathname === '/about' || pathname === '/about/';
const isResume = pathname === '/resume' || pathname === '/resume/';
const ogImage = image || "https://mikevincent.dev/assets/images/og-default.jpg";
const canonicalURL = new URL(Astro.url.pathname, "https://mikevincent.dev");
---

<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="/icon.png" />
  <link rel="canonical" href={canonicalURL} />
  <link rel="stylesheet" href="https://www.apple.com/wss/fonts?families=SF+Pro,v1|SF+Pro+Icons,v1" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <title>{title}</title>
  <meta name="description" content={description} />

  <!-- OpenGraph -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content={canonicalURL} />
  <meta property="og:title" content={title} />
  <meta property="og:description" content={description} />
  <meta property="og:image" content={ogImage} />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content={title} />
  <meta name="twitter:description" content={description} />
  <meta name="twitter:image" content={ogImage} />

  <!-- Safari browser chrome color -->
  <meta name="theme-color" content="#fff" media="(prefers-color-scheme: light)" />
  <meta name="theme-color" content="#000" media="(prefers-color-scheme: dark)" />

  <ViewTransitions />
</head>
<body>
  <script is:inline>
    let themeMode = localStorage.getItem('theme') || 'system';
    function setTheme() {
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const isDark = themeMode === 'system' ? prefersDark : themeMode === 'dark';
      document.body.classList.toggle('theme-dark', isDark);
      document.body.classList.toggle('theme-light', !isDark);
      // Update Safari browser chrome color
      const themeColor = isDark ? '#000' : '#fff';
      document.querySelectorAll('meta[name="theme-color"]').forEach(m => m.content = themeColor);
      const btn = document.querySelector('.theme-toggle');
      if (btn) {
        const icon = themeMode === 'system' ? 'contrast' : (themeMode === 'dark' ? 'dark_mode' : 'light_mode');
        const label = themeMode === 'system' ? 'System' : (themeMode === 'dark' ? 'Dark' : 'Light');
        btn.innerHTML = `<span class="material-symbols-outlined">${icon}</span><span class="theme-text">${label}</span><span class="chevrons"><span class="material-symbols-outlined">expand_less</span><span class="material-symbols-outlined">expand_more</span></span>`;
      }
    }
    function toggleTheme() {
      if (themeMode === 'system') themeMode = 'light';
      else if (themeMode === 'light') themeMode = 'dark';
      else themeMode = 'system';
      localStorage.setItem('theme', themeMode);
      setTheme();
    }
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
      if (themeMode === 'system') setTheme();
    });
    document.addEventListener('DOMContentLoaded', setTheme);
    document.addEventListener('astro:after-swap', setTheme);
    setTheme();

    // Hide header on scroll down, show on scroll up
    function initScrollHeader() {
      let lastScroll = 0;
      let scrollUpAmount = 0;
      const header = document.querySelector('.site-header-wrapper');
      if (!header) return;
      window.addEventListener('scroll', () => {
        const currentScroll = window.scrollY;
        const isAtBottom = (window.innerHeight + window.scrollY) >= document.body.offsetHeight - 10;
        if (currentScroll > lastScroll && currentScroll > 60) {
          header.classList.add('hidden');
          scrollUpAmount = 0;
        } else if (!isAtBottom) {
          scrollUpAmount += lastScroll - currentScroll;
          if (scrollUpAmount > 30 || currentScroll < 60) {
            header.classList.remove('hidden');
          }
        }
        lastScroll = currentScroll;
      });
    }
    document.addEventListener('DOMContentLoaded', initScrollHeader);
    document.addEventListener('astro:after-swap', initScrollHeader);
  </script>

  <div class="site-header-wrapper">
    <div class="section-content">
      <div class="row">
        <div class="column large-centered large-10 small-12">
          <header class="site-header">
            <div class="site-header-top">
              <div class="site-header-left">
                <a href="/">Mike Vincent</a>
              </div>
              <button class="theme-toggle" onclick="toggleTheme()">Light</button>
            </div>
            <nav class="site-header-right">
              {(isBio || isResume || isPost) ? (
                <a href="/" class="nav-back">
                  <span class="material-symbols-outlined" transition:animate="fade">west</span>
                  {isBio ? (
                    <span class="nav-text" data-text="Bio" transition:name="nav-bio">Bio</span>
                  ) : isResume ? (
                    <span class="nav-text" data-text="Resume" transition:name="nav-resume">Resume</span>
                  ) : (
                    <span class="nav-text" data-text="Post">Post</span>
                  )}
                </a>
              ) : (
                <>
                  <a href="/about"><span class="material-symbols-outlined" transition:animate="fade">person</span><span class="nav-text" data-text="Bio" transition:name="nav-bio">Bio</span></a>
                  <a href="/resume"><span class="material-symbols-outlined" transition:animate="fade">article</span><span class="nav-text" data-text="Resume" transition:name="nav-resume">Resume</span></a>
                  <a href="https://dev.to/mike-vincent" target="_blank" rel="noopener noreferrer"><span class="material-symbols-outlined" transition:animate="fade">public</span><span class="nav-text">Quark's Outlines</span></a>
                </>
              )}
            </nav>
          </header>
        </div>
      </div>
    </div>
  </div>

  <main>
    <slot />
  </main>

  <div class="site-footer-wrapper">
    <div class="section-content">
      <div class="row">
        <div class="column large-centered large-10 small-12">
          <footer class="site-footer">
            Copyright &copy; {new Date().getFullYear()} Mike Vincent. All rights reserved.
          </footer>
        </div>
      </div>
    </div>
  </div>
</body>
</html>

<style is:global>
  @import '../styles/global.css';
</style>
