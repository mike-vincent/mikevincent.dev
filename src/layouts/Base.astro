---
import { ViewTransitions } from 'astro:transitions';

interface Props {
  title: string;
  description?: string;
  image?: string;
}

const { title, description = "Mike Vincent - Software Engineer", image } = Astro.props;
const pathname = Astro.url.pathname;
const isHome = pathname === '/' || pathname === '';
const isBio = pathname === '/about' || pathname === '/about/';
const isResume = pathname === '/resume' || pathname === '/resume/';
const isBrands =
  pathname === '/brands' ||
  pathname === '/brands/' ||
  pathname === '/past-projects' ||
  pathname === '/past-projects/' ||
  pathname.startsWith('/past-projects/') ||
  pathname === '/case-studies' ||
  pathname === '/case-studies/' ||
  pathname.startsWith('/case-studies/');
const isDetail = isBio || isResume || isBrands;
const ogImage = image || "https://mikevincent.dev/og.png";
const canonicalURL = new URL(Astro.url.pathname, "https://mikevincent.dev");
---

<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="/icon.png" />
  <link rel="canonical" href={canonicalURL} />
  <link rel="stylesheet" href="https://www.apple.com/wss/fonts?families=SF+Pro,v1|SF+Pro+Icons,v1" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <title>{title}</title>
  <meta name="description" content={description} />

  <!-- OpenGraph -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content={canonicalURL} />
  <meta property="og:title" content={title} />
  <meta property="og:description" content={description} />
  <meta property="og:image" content={ogImage} />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content={title} />
  <meta name="twitter:description" content={description} />
  <meta name="twitter:image" content={ogImage} />

  <!-- Safari browser chrome color -->
  <meta name="theme-color" content="#fff" media="(prefers-color-scheme: light)" />
  <meta name="theme-color" content="#000" media="(prefers-color-scheme: dark)" />

  <ViewTransitions />
</head>
<body>
  <script is:inline>
    let themeMode = localStorage.getItem('theme') || 'system';
    function setTheme() {
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const isDark = themeMode === 'system' ? prefersDark : themeMode === 'dark';
      document.body.classList.toggle('theme-dark', isDark);
      document.body.classList.toggle('theme-light', !isDark);
      // Update Safari browser chrome color
      const themeColor = isDark ? '#000' : '#fff';
      document.querySelectorAll('meta[name="theme-color"]').forEach(m => m.content = themeColor);
      const btn = document.querySelector('.theme-toggle');
      if (btn) {
        const icon = themeMode === 'system' ? 'contrast' : (themeMode === 'dark' ? 'dark_mode' : 'light_mode');
        btn.innerHTML = `<span class="material-symbols-outlined">${icon}</span>`;
      }
    }
    function toggleTheme() {
      if (themeMode === 'system') themeMode = 'light';
      else if (themeMode === 'light') themeMode = 'dark';
      else themeMode = 'system';
      localStorage.setItem('theme', themeMode);
      setTheme();
    }
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
      if (themeMode === 'system') setTheme();
    });
    document.addEventListener('DOMContentLoaded', setTheme);
    document.addEventListener('astro:after-swap', setTheme);
    setTheme();

    // Hide header on scroll down, show on scroll up
    function initScrollHeader() {
      let lastScroll = 0;
      let scrollUpAmount = 0;
      const header = document.querySelector('.site-header-wrapper');
      if (!header) return;
      window.addEventListener('scroll', () => {
        const currentScroll = window.scrollY;
        const isAtBottom = (window.innerHeight + window.scrollY) >= document.body.offsetHeight - 10;
        if (currentScroll > lastScroll && currentScroll > 60) {
          header.classList.add('hidden');
          scrollUpAmount = 0;
        } else if (!isAtBottom) {
          scrollUpAmount += lastScroll - currentScroll;
          if (scrollUpAmount > 30 || currentScroll < 60) {
            header.classList.remove('hidden');
          }
        }
        lastScroll = currentScroll;
      });
    }
    document.addEventListener('DOMContentLoaded', initScrollHeader);
    document.addEventListener('astro:after-swap', initScrollHeader);

    function initShare() {
      const btn = document.getElementById('share-btn');
      if (!btn) return;
      btn.onclick = () => {
        if (navigator.share) {
          navigator.share({ title: document.title, url: window.location.href });
        } else {
          navigator.clipboard.writeText(window.location.href);
        }
      };
    }
    document.addEventListener('DOMContentLoaded', initShare);
    document.addEventListener('astro:after-swap', initShare);
  </script>

  <div class="page-rails"></div>
  <div class="site-header-wrapper">
    <div class="section-content">
      <header class="site-header">
        <a href="/" class="site-header-link"><div class="avatar-wrap"><span class="avatar">MV</span></div><div class="header-name-block"><span class="header-name">Mike Vincent</span><span class="header-subtitle">Software Engineer</span></div></a>
        {!isResume && <button class="theme-toggle" onclick="toggleTheme()">Light</button>}
        {isResume && (
          <a class="header-action" href="/resume.pdf" download title="Download PDF" style="margin-left:auto"><span class="material-symbols-outlined">download</span></a>
          <button class="header-action" onclick="window.print()" title="Print"><span class="material-symbols-outlined">print</span></button>
        )}
        <button class="header-action share-btn" id="share-btn" title="Share Resume"><span class="material-symbols-outlined">ios_share</span><span class="share-label">Share Resume</span></button>
      </header>
      <nav class="site-nav-row">
        <a href="/" class={isHome ? 'active' : ''}>
          <span class="nav-tab-inner">
            <span class="icon-square"><span class={`material-symbols-outlined${isHome ? ' filled' : ''}`}>home</span></span>
            <span>Home</span>
          </span>
        </a>
        <a href="/brands" class={isBrands ? 'active' : ''}>
          <span class="nav-tab-inner">
            <span class="icon-square"><span class={`material-symbols-outlined${isBrands ? ' filled' : ''}`}>auto_awesome</span></span>
            <span>Projects</span>
          </span>
        </a>
        <a href="/resume" class={isResume ? 'active' : ''}>
          <span class="nav-tab-inner">
            <span class="icon-square"><span class={`material-symbols-outlined${isResume ? ' filled' : ''}`}>article</span></span>
            <span>Resume</span>
          </span>
        </a>
      </nav>
    </div>
  </div>

  <main>
    <div class="section-content page-content">
      <slot />
    </div>
  </main>

  <div class="site-footer-border"></div>
  <div class="section-content">
    <footer class="site-footer">
      Copyright &copy; {new Date().getFullYear()} Mike Vincent. All rights reserved.
    </footer>
  </div>
</body>
</html>

<style is:global>
  @import '../styles/global.css';
</style>
